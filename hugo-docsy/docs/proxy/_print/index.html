<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.84.4" /><link rel="canonical" type="text/html" href="https://gchq.github.io/stroom-docs/hugo-docsy/docs/proxy/">
<META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">


<link rel="shortcut icon" href="/stroom-docs/hugo-docsy/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/stroom-docs/hugo-docsy/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/stroom-docs/hugo-docsy/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/stroom-docs/hugo-docsy/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/stroom-docs/hugo-docsy/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/stroom-docs/hugo-docsy/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/stroom-docs/hugo-docsy/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/stroom-docs/hugo-docsy/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/stroom-docs/hugo-docsy/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/stroom-docs/hugo-docsy/favicons/android-192x192.png" sizes="192x192">

<title>Stroom Proxy | Stroom</title>
<meta name="description" content="A Stroom example site"><meta property="og:title" content="Stroom Proxy" />
<meta property="og:description" content="Stroom Proxy acts as a proxy when sending data to a Stroom instance. Stroom Proxy has various modes such as storing, aggregating and forwarding the received data. Stroom Proxies can forward to other Stroom Proxy instances.
" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://gchq.github.io/stroom-docs/hugo-docsy/docs/proxy/" /><meta property="og:site_name" content="Stroom" />

<meta itemprop="name" content="Stroom Proxy">
<meta itemprop="description" content="Stroom Proxy acts as a proxy when sending data to a Stroom instance. Stroom Proxy has various modes such as storing, aggregating and forwarding the received data. Stroom Proxies can forward to other Stroom Proxy instances.
"><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Stroom Proxy"/>
<meta name="twitter:description" content="Stroom Proxy acts as a proxy when sending data to a Stroom instance. Stroom Proxy has various modes such as storing, aggregating and forwarding the received data. Stroom Proxies can forward to other Stroom Proxy instances.
"/>




<link rel="preload" href="/stroom-docs/hugo-docsy/scss/main.min.1f2952c7a172c24c500f8a29d50455aa09005756d180e87d70fbb3930c26306c.css" as="style">
<link href="/stroom-docs/hugo-docsy/scss/main.min.1f2952c7a172c24c500f8a29d50455aa09005756d180e87d70fbb3930c26306c.css" rel="stylesheet" integrity="">


<script
  src="https://code.jquery.com/jquery-3.5.1.min.js"
  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
  crossorigin="anonymous"></script>

<script
  src="https://unpkg.com/lunr@2.3.8/lunr.min.js"
  integrity="sha384-vRQ9bDyE0Wnu+lMfm57BlYLO0/XauFuKpVsZPs7KEDwYKktWi5+Kz3MP8++DFlRY"
  crossorigin="anonymous"></script>





  </head>
  <body class="td-section">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
        <a class="navbar-brand" href="/stroom-docs/hugo-docsy/">
		<span class="navbar-logo"><svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" width="110.61089" height="30.000004" viewBox="0 0 88.488641 23.999957" id="svg2" inkscape:version="0.91 r13725" sodipodi:docname="logo.svg"><defs id="defs20"/><sodipodi:namedview pagecolor="#989898" bordercolor="#666666" borderopacity="1" objecttolerance="10" gridtolerance="10" guidetolerance="10" inkscape:pageopacity="0" inkscape:pageshadow="2" inkscape:window-width="1920" inkscape:window-height="1137" id="namedview18" showgrid="false" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:zoom="5.5951814" inkscape:cx="55.451414" inkscape:cy="16.275348" inkscape:window-x="0" inkscape:window-y="0" inkscape:window-maximized="1" inkscape:current-layer="svg2"/><g id="g4150" style="opacity:.97000002" transform="matrix(0.03883584,0,0,0.03883584,0,-3.1155874e-4)"><path id="path6" d="M121.99991 205.98497C54.999958 205.98497.0 259.98493.0 327.98487c0 66.99994 54.999958 121.99989 121.99991 121.99989h167.99987c24.99998.0 44.99996 20.99998 44.99996 44.99996.0 24.99998-19.99998 44.99996-44.99996 44.99996H109.20929C65.984126 553.87219 27.100843 581.57313.01093599 617.98462H289.99978c66.99994.0 121.99991-54.99996 121.99991-122.9999.0-66.99994-54.99997-121.99989-121.99991-121.99989H121.99991c-24.999984.0-44.999969-19.99999-44.999969-44.99996.0-24.99998 19.999985-44.99996 44.999969-44.99996h228.79045c26.9905-35.88325 65.47093-63.18547 108.21554-76.99994H121.99991z" style="fill:#fff" inkscape:connector-curvature="0"/><path id="path8" d="M601.44485-.00077860649C572.6583 8.3697982 546.49491 22.822962 524.44491 41.902305V205.78969l.002.19528h-.002c-65.11 48e-5-123.03145 30.0199-160.74675 76.99994h160.74675v334.99971h76.99994V282.98491h144.85298c27.16134-36.05885 65.96411-63.39275 109.02184-76.99994H601.44485v-205.98574860649z" style="fill:#fff" inkscape:connector-curvature="0"/><path id="path10" d="m919.42586 205.98497c-113.99519.0-205.99537 92.00648-206.00296 205.99982-15e-5 68.67178.0 137.32749.0 205.99983h77.99994c-.012-68.6493.0176-137.46869.0-205.99983.0846-70.92785 57.05747-128.99988 128.00462-128.99988 5.28623.0 10.49823.32864 15.62183.95311 18.2219-24.51229 41.78461-45.0838 68.42501-60.15146-25.65065-11.43799-54.08662-17.80159-84.04684-17.80159z" style="fill:#fff" inkscape:connector-curvature="0"/><path id="path12" d="m1109.4153 205.98457c-113.99994.0-205.99983 91.99993-205.99983 205.99984.0 112.9999 91.99989 205.9998 205.99983 205.9998 114 0 205.9999-92.9999 205.9999-205.9998.0-113.99991-91.9999-205.99984-205.9999-205.99984zm0 333.99974c-70.9999.0-128.99994-56.99996-128.99994-127.9999.0-70.99995 58.00004-128.9999 128.99994-128.9999 71 0 128.9999 57.99995 128.9999 128.9999.0 70.99994-57.9999 127.9999-128.9999 127.9999z" style="fill:#fff" inkscape:connector-curvature="0"/><path id="path14" d="m1444.4737 205.98457c-113.9999.0-205.9998 91.99993-205.9998 205.99984.0 112.9999 91.9999 205.9998 205.9998 205.9998s205.9999-92.9999 205.9999-205.9998c0-113.99991-92-205.99984-205.9999-205.99984zm0 333.99974c-70.9999.0-128.9999-56.99996-128.9999-127.9999.0-70.99995 58-128.9999 128.9999-128.9999 71 0 128.9999 57.99995 128.9999 128.9999.0 70.99994-57.9999 127.9999-128.9999 127.9999z" style="fill:#fff" inkscape:connector-curvature="0"/><path id="path16" d="m1738.5308 379.98447c0-53 43-97 95.9999-97 53 0 97 44 97 97v237.9997h76.9999v-237.9997c0-53 43-97 96.9999-97 53 0 95.9999 44 95.9999 97v237.9997h77v-237.9997c0-96-77-173.9999-172.9999-173.9999-54.9999.0-103.9999 24.99998-135.9999 64.99995-31.9999-39.99997-79.9999-64.99995-134.9999-64.99995-95.9999.0-173.9998 77.9999-173.9998 173.9999v237.9997h77.9999z" style="fill:#fff" inkscape:connector-curvature="0"/></g></svg></span><span class="text-uppercase font-weight-bold">Stroom</span>
	</a>
	<div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
		<ul class="navbar-nav mt-2 mt-lg-0">
			
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link" href="/stroom-docs/hugo-docsy/about/" ><span>About</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link active" href="/stroom-docs/hugo-docsy/docs/" ><span class="active">Documentation</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link" href="/stroom-docs/hugo-docsy/news/" ><span>News / Releases</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link" href="/stroom-docs/hugo-docsy/community/" ><span>Community</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link" href="/stroom-docs/hugo-docsy/docs/style-guide/" ><span>Style Guide (DRAFT)</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link" href="/stroom-docs/hugo-docsy/all-content/" ><span>All Content (DRAFT)</span></a>
			</li>
			
			
			
		</ul>
	</div>
	<div class="navbar-nav d-none d-lg-block">



<input
  type="search"
  class="form-control td-search-input"
  placeholder="&#xf002; Search this site…"
  aria-label="Search this site…"
  autocomplete="off"
  
  data-offline-search-index-json-src="/stroom-docs/hugo-docsy/offline-search-index.914bcaafd0e144bc7693c4b6b1cc342e.json"
  data-offline-search-base-href="/"
  data-offline-search-max-results="50"
>

</div>
</nav>

    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
          </div>
          <div class="d-none d-xl-block col-xl-2 td-toc d-print-none">
          </div>
          <main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
            




<div class="td-content">
<div class="pageinfo pageinfo-primary d-print-none">
<p>
This the multi-page printable view of this section.
<a href="#" onclick="print();return false;">Click here to print</a>.
</p><p>
<a href="/stroom-docs/hugo-docsy/docs/proxy/">Return to the regular view of this page</a>.
</p>
</div>



<h1 class="title">Stroom Proxy</h1>
<div class="lead">Stroom Proxy acts as a proxy when sending data to a Stroom instance. Stroom Proxy has various modes such as storing, aggregating and forwarding the received data. Stroom Proxies can forward to other Stroom Proxy instances.</div>




    <ul>
    
  
  
  
  

  
    
    
	
<li>1: <a href="#pg-4a9ccf1be15151102f421a8f9486c86d">Apache Forwarding</a></li>


    
  
    
    
	
<li>2: <a href="#pg-282abd8e77097d1d1e818b714efb1276">Running with docker</a></li>


    
  
    
    
	
<li>3: <a href="#pg-50486f41ef9bd8fcad0abc31cffc328d">Stroom Proxy Installation</a></li>


    
  

    </ul>


<div class="content">
      
</div>
</div>


  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-4a9ccf1be15151102f421a8f9486c86d">1 - Apache Forwarding</h1>
    
	
<div class="pageinfo pageinfo-danger">
<h4 class="text-danger alert-heading">Warning</h4>
<p>This document refers to v5.</p>

</div>


<p>Stroom Proxy defaults to listening for HTTP on port 9080.
It is recommended that Apache is used to listen on the standard HTTP port 80 and forward requests on via the Apache mod_jk module and the AJP protocol (on 9009).
Apache can also perform HTTPS on port 443 and pass over requests to Tomcat using the same AJP protocol.</p>
<p>It is additionally recommended that Stroom Proxy is used to front data ingest and so Apache is configured to route traffic to http(s)://server/stroom/datafeed to Stroom Proxy.</p>
<h2 id="prerequisites">Prerequisites</h2>
<ul>
<li>tomcat-connectors-1.2.31-src.tar.gz</li>
</ul>
<h2 id="setup-apache">Setup Apache</h2>
<ul>
<li>As root</li>
<li>Patch mod_jk</li>
</ul>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#366">cd</span> ~/tmp
tar -xvzf tomcat-connectors-1.2.31-src.tar.gz 
<span style="color:#366">cd</span> tomcat-connectors-1.2.31-src/native
./configure --with-apxs<span style="color:#555">=</span>/usr/sbin/apxs 
make
sudo cp apache-2.0/mod_jk.so /etc/httpd/modules/
<span style="color:#366">cd</span>
</code></pre></div><ul>
<li>Put the web server cert, private key, and CA cert into the web servers conf directory  /etc/httpd/conf.  E.g.</li>
</ul>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#555">[</span>user@node1 stroom-doc<span style="color:#555">]</span>$ ls -al /etc/httpd/conf
....
-rw-r--r-- <span style="color:#f60">1</span> root root  <span style="color:#f60">1729</span> Aug <span style="color:#f60">27</span>  <span style="color:#f60">2013</span> host.crt
-rw-r--r-- <span style="color:#f60">1</span> root root  <span style="color:#f60">1675</span> Aug <span style="color:#f60">27</span>  <span style="color:#f60">2013</span> host.key
-rw-r--r-- <span style="color:#f60">1</span> root root  <span style="color:#f60">1289</span> Aug <span style="color:#f60">27</span>  <span style="color:#f60">2013</span> CA.crt
....
</code></pre></div><ul>
<li>Make changes to /etc/http/conf.d/ssl.conf as per below</li>
</ul>
<pre><code>JkMount /stroom/datafeed* loadbalancer_proxy
JkMount /stroom* loadbalancer_proxy
</code></pre><pre><code>JkOptions +ForwardKeySize +ForwardURICompat +ForwardSSLCertChain -ForwardDirectories

SSLCertificateFile /etc/httpd/conf/[YOUR SERVER].crt
SSLCertificateKeyFile /etc/httpd/conf/[YOUR SERVER].key
SSLCertificateChainFile /etc/httpd/conf/[YOUR CA].crt
SSLCACertificateFile /etc/httpd/conf/[YOUR CA APPENDED LIST].crt
</code></pre><ul>
<li>Remove /etc/httpd/conf.d/nss.conf to avoid a 8443 port clash</li>
</ul>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">rm /etc/httpd/conf.d/nss.conf 
</code></pre></div><ul>
<li>Create a /etc/httpd/conf.d/mod_jk.conf configuration</li>
</ul>
<pre><code>LoadModule jk_module modules/mod_jk.so
JkWorkersFile conf/workers.properties
JkLogFile logs/mod_jk.log
JkLogLevel info
JkLogStampFormat  &quot;[%a %b %d %H:%M:%S %Y]&quot;
JkOptions +ForwardKeySize +ForwardURICompat +ForwardSSLCertChain -ForwardDirectories
JkRequestLogFormat &quot;%w %V %T&quot;
</code></pre><pre><code>JkMount /stroom/datafeed* loadbalancer_proxy
JkMount /stroom* loadbalancer_proxy
</code></pre><pre><code>JkShmFile logs/jk.shm
&lt;Location /jkstatus/&gt;
    JkMount status
    Order deny,allow
    Deny from all
    Allow from 127.0.0.1
&lt;/Location&gt;
</code></pre><ul>
<li>Setup stroom-setup/cluster.txt, generate the workers file and copy into Apache.  (as root and replace stroomuser with your processing user)</li>
</ul>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">/home/stroomuser/stroom-setup/workers.properties.sh --cluster<span style="color:#555">=</span>/home/stroomuser/cluster.txt &gt; /etc/httpd/conf/workers.properties
</code></pre></div><ul>
<li>Inspect /etc/httpd/conf/workers.properties to make sure it looks as you expect for your cluster</li>
</ul>
<pre><code>worker.list=loadbalancer_proxy,local_proxy
worker.stroom_1_proxy.port=9009
worker.stroom_1_proxy.host=localhost
worker.stroom_1_proxy.type=ajp13
worker.stroom_1_proxy.lbfactor=1
worker.stroom_1_proxy.max_packet_size=65536
....
....
worker.loadbalancer_proxy.type=lb
worker.loadbalancer_proxy.balance_workers=stroom_1_proxy,stroom_2_proxy
worker.loadbalancer_proxy.sticky_session=1
worker.local_proxy.type=lb
worker.local_proxy.balance_workers=stroom_1_proxy
worker.local_proxy.sticky_session=1
</code></pre><ul>
<li>Create a simple redirect page to the stroom web app for the root URL (e.g. DocumentRoot &ldquo;/var/www/html&rdquo;, index.html)</li>
</ul>
<pre><code>&amp;lt;html&amp;gt;&amp;lt;head&amp;gt;&amp;lt;meta http-equiv=&quot;Refresh&quot; content=&quot;0; URL=stroom&quot;&amp;gt;&amp;lt;/head&amp;gt;&amp;lt;/html&amp;gt;
</code></pre><ul>
<li>Restart Apache and then test default http / https access.</li>
</ul>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo /etc/init.d/httpd restart
</code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-282abd8e77097d1d1e818b714efb1276">2 - Running with docker</h1>
    
	
<div class="alert alert-secondary" role="alert">
<h4 class="alert-heading">TODO</h4>

    This document is out of date and needs updating to refer to the stroom-proxy docker stack.

</div>

<h2 id="clone-and-build-_stroom-proxy_">Clone and build <em>stroom-proxy</em></h2>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">git clone https://github.com/gchq/stroom-proxy.git
mvn clean install
</code></pre></div><h2 id="unpack-the-stroom-proxy-distribution-in-preparation-for-building-the-docker-iamge">Unpack the <code>stroom-proxy</code> distribution in preparation for building the docker iamge</h2>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#366">cd</span> stroom-proxy-distribution
unzip target/stroom-proxy-distribution-&lt;version&gt;-bin.zip -d target
</code></pre></div><h2 id="building-and-running-the-docker-image">Building and running the docker image</h2>
<p>Here you need to say where you want data to be sent by <code>stroom-proxy</code>.
This is done using a <a href="https://docs.docker.com/engine/reference/commandline/build/#/set-build-time-variables-build-arg"><code>--build-arg</code> (external link)</a> parameter of <code>STROOM_PROXY_TYPE</code>.
These values can be <code>forward</code>, <code>store</code>, or <code>store_nodb</code>. See the <em>stroom-proxy</em> section in the <a href="https://github.com/gchq/stroom-docs/blob/master/SUMMARY.md">stroom documentation (external link)</a> documentation for more details about these options.</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker stop stroom-proxy
docker rm stroom-proxy
docker rmi stroom-proxy

docker build --build-arg <span style="color:#033">STROOM_PROXY_TYPE</span><span style="color:#555">=</span>store_nodb --tag<span style="color:#555">=</span>stroom-proxy:latest target/stroom-proxy
docker run -p 8080:8080 --name<span style="color:#555">=</span>stroom-proxy stroom-proxy
</code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-50486f41ef9bd8fcad0abc31cffc328d">3 - Stroom Proxy Installation</h1>
    
	
<div class="pageinfo pageinfo-danger">
<h4 class="text-danger alert-heading">Warning</h4>
<p>This document refers to v5.</p>

</div>


<h2 id="prerequisites">Prerequisites</h2>
<ul>
<li>Linux Server&rsquo;s with at least 4GB RAM</li>
<li>Install files stroom-proxy-X-Y-Z-distribution.zip, stroom-deploy-X-Y-Z-distribution.zip</li>
<li>Temporarily allow port 9080 if not relying on Apache Forwarding (see below)</li>
</ul>
<h2 id="processing-user-setup">Processing User Setup</h2>
<p>See <a href="../install-guide/setup/processing-user-setup.md">Processing User Setup</a>.</p>
<h2 id="installing-stroom-proxy">Installing Stroom Proxy</h2>
<p>As the processing user unpack the stroom-proxy-X-Y-Z-distribution.zip installation files
in the processing users home directory.</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">unzip stroom-proxy-X-Y-Z-distribution.zip
</code></pre></div><p>Stroom Proxy can be setup as follows:</p>
<ul>
<li>forward - as an aggregation point to store and forwarding onto another Stroom or Stroom / Proxy</li>
<li>store - to front Stroom for data ingest</li>
</ul>
<h3 id="stroom-proxy---forward">Stroom Proxy - forward</h3>
<p>In forward mode you need to know the server address that data is being sent onto.
Run the setup script to capture the basic settings required to run Stroom Proxy in forward mode.</p>
<ul>
<li>@@ NODE @@ - Each Stroom instance in the cluster needs a unique name, if this is a reinstall ensure you use the previous deployment.
<strong>This name needs match the name used in your worker.properties (e.g. &lsquo;node1&rsquo; in the case &lsquo;node1.my.org&rsquo;)</strong></li>
<li>@@ PORT PREFIX @@ - By default Stroom Proxy will run on port 9080</li>
</ul>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#555">[</span>stroomuser@node1 ~<span style="color:#555">]</span>$ ./stroom-proxy/bin/setup.sh forward

<span style="color:#555">[</span>stroomuser@dev1 ~<span style="color:#555">]</span>$ ./stroom-proxy/bin/setup.sh forward





...

<span style="color:#033">Parameters</span>
<span style="color:#555">==========</span>

@@NODE@@           : Unique node name <span style="color:#069;font-weight:bold">for</span> install <span style="color:#555">[</span>node1                                                     <span style="color:#555">]</span> : node1
@@PORT_PREFIX@@    : HTTP prefix to use           <span style="color:#555">[</span><span style="color:#f60">90</span>                                                        <span style="color:#555">]</span> : <span style="color:#f60">90</span>
@@REPO_DIR@@       : Stroom Proxy Repository Dir     <span style="color:#555">[</span>/stroomdata/stroom-proxy                                        <span style="color:#555">]</span> : /home/stroomuser/stroom-proxy-repo
@@FORWARD_SERVER@@ : Server to forward data on to <span style="color:#555">[</span>hostname                                                  <span style="color:#555">]</span> : audit.my.org
@@JAVA_OPTS@@      : Optional tomcat JVM settings <span style="color:#555">[</span><span style="color:#c30">&#34;-Xms512m -Xmx1g&#34;</span>                                         <span style="color:#555">]</span> :

...
</code></pre></div><h3 id="stroom-proxy---store">Stroom Proxy - store</h3>
<p>In store mode you need to know the mysql details to validate incoming data with.</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#555">[</span>stroomuser@node1 ~<span style="color:#555">]</span>$ ./stroom-proxy-app/bin/setup.sh store

...

@@NODE@@           : Unique node name <span style="color:#069;font-weight:bold">for</span> install            <span style="color:#555">[</span>node                                                      <span style="color:#555">]</span> :
@@PORT_PREFIX@@    : HTTP prefix to use                      <span style="color:#555">[</span><span style="color:#f60">90</span>                                                        <span style="color:#555">]</span> : <span style="color:#f60">72</span>
@@REPO_DIR@@       : Stroom Proxy Repository Dir                <span style="color:#555">[</span>/stroomdata/stroom-proxy                                        <span style="color:#555">]</span> : /home/stroomuser/stroom-proxy-repo-2
@@JDBC_CLASSNAME@@ : JDBC class name                         <span style="color:#555">[</span>com.mysql.jdbc.Driver                                     <span style="color:#555">]</span> :
@@JDBC_URL@@       : JDBC URL <span style="color:#555">(</span>jdbc:mysql://<span style="color:#555">[</span>HOST<span style="color:#555">]</span>/<span style="color:#555">[</span>DBNAME<span style="color:#555">])</span> <span style="color:#555">[</span>jdbc:mysql://localhost/stroom                                <span style="color:#555">]</span> :
@@DB_USERNAME@@    : Database username                       <span style="color:#555">[</span>                                                          <span style="color:#555">]</span> : stroomuser
@@DB_PASSWORD@@    : Database password                       <span style="color:#555">[</span>                                                          <span style="color:#555">]</span> :
@@JAVA_OPTS@@      : Optional tomcat JVM settings            <span style="color:#555">[</span><span style="color:#c30">&#34;-Xms512m -Xmx1g&#34;</span>                                         <span style="color:#555">]</span> :
</code></pre></div><h3 id="install-check">Install Check</h3>
<p>Start the installed instance:</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">./stroom-deploy/start.sh
</code></pre></div><p>Inspect the logs:</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">tail -f stroom-proxy-app/instance/logs/stroom.log
</code></pre></div><h3 id="stroom-proxy-properties">Stroom Proxy Properties</h3>
<p>The following properties can be configured in the stroom.properties file.</p>
<p>TODO - Could do with a column indicating which proxy mode these properties apply to, e.g. store/forward</p>
<table>
<thead>
<tr>
<th>Property Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>repoDir</td>
<td>Optional Repository DIR. If set any incoming request will be written to the file system.</td>
</tr>
<tr>
<td>logRequest</td>
<td>Optional log line with header attributes output as defined by this property</td>
</tr>
<tr>
<td>bufferSize</td>
<td>Override default (8192) JDK buffer size to use</td>
</tr>
<tr>
<td>forwardUrl</td>
<td>Optional The URL&rsquo;s to forward onto This is pass-through mode if repoDir is not set</td>
</tr>
<tr>
<td>forwardThreadCount</td>
<td>Number of threads to forward with</td>
</tr>
<tr>
<td>forwardTimeoutMs</td>
<td>Time out when forwarding</td>
</tr>
<tr>
<td>forwardChunkSize</td>
<td>Chunk size to use over http(s) if not set requires buffer to be fully loaded into memory</td>
</tr>
<tr>
<td>rollCron</td>
<td>Interval to roll any writing repositories.</td>
</tr>
<tr>
<td>readCron</td>
<td>Cron style interval (e.g. every hour &lsquo;0 * *&rsquo;, every half hour &lsquo;0,30 * *') to read any ready repositories (if not defined we read all the time).</td>
</tr>
<tr>
<td>maxAggregation</td>
<td>Aggregate size to break at when building an aggregate.</td>
</tr>
<tr>
<td>zipFilenameDelimiter</td>
<td>The delimiter used to separate the id ihe zip filename from the templated part</td>
</tr>
<tr>
<td>zipFilenameTemplate</td>
<td>A template for naming the zip files in the repository where files will be named nnn!zipFilenameTemplate.zip where nnn is the id prefix, ! is the configurable delimiter and zipFilenameTemplate will be something like &lsquo;${feed}!${headerMapKey1}!${headerMapKey2}&rsquo;. The naem of each variable must exactly match a key in the meta data else it will resolve to &lsquo;&rsquo;.</td>
</tr>
<tr>
<td>requestDelayMs</td>
<td>Sleep time used to aid with testing</td>
</tr>
<tr>
<td>forwardDelayMs</td>
<td>Debug setting to add a delay</td>
</tr>
<tr>
<td>dbRequestValidatorContext</td>
<td>Database Feed Validator - Data base JDBC context</td>
</tr>
<tr>
<td>dbRequestValidatorJndiName</td>
<td>Database Feed Validator - Data base JDBC JNDI name</td>
</tr>
<tr>
<td>dbRequestValidatorFeedQuery</td>
<td>Database Feed Validator - SQL to check feed status</td>
</tr>
<tr>
<td>dbRequestValidatorAuthQuery</td>
<td>Database Feed Validator - SQL to check authorisation required</td>
</tr>
<tr>
<td>remotingUrl</td>
<td>Url to use for remoting services</td>
</tr>
<tr>
<td>remotingReadTimeoutMs</td>
<td>Change from the default JVM settings.</td>
</tr>
<tr>
<td>remotingConnectTimeoutMs</td>
<td>Change from the default JVM settings.</td>
</tr>
<tr>
<td>maxStreamSize</td>
<td>Stream size to break at when building an aggregate.</td>
</tr>
<tr>
<td>maxFileScan</td>
<td>Max number of files to scan over during forwarding.  Once this limit is it it will wait until next read interval</td>
</tr>
<tr>
<td>cacheTimeToIdleSeconds</td>
<td>Time to idle settings to used for validating feed information</td>
</tr>
<tr>
<td>cacheTimeToLiveSeconds</td>
<td>Time to live settings to used for validating feed information</td>
</tr>
</tbody>
</table>
<h2 id="apache-forwarding">Apache Forwarding</h2>
<p>See <a href="../install-guide/setup/apache-forwarding.md">Apache Forwarding</a>.</p>
<h2 id="java-key-store-setup">Java Key Store Setup</h2>
<p>If you require that Stroom Proxy communicates over 2-way https you will need to set up Java Key Stores.</p>
<p>See <a href="../install-guide/setup/java-key-store-setup.md">Java Key Store Setup</a>.</p>
<h2 id="securing-stroom">Securing Stroom</h2>
<p>See <a href="../install-guide/setup/securing-stroom.md">Securing Stroom</a>.</p>

</div>



    
	
  



          </main>
        </div>
      </div>
      
<footer class="bg-dark py-5 row d-print-none">
  <div class="container-fluid mx-sm-5">
    <div class="row">
      <div class="col-6 col-sm-4 text-xs-center order-sm-2">
        
        
        
      </div>
      <div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="GitHub" aria-label="GitHub">
    <a class="text-white" target="_blank" rel="noopener" href="https://github.com/gchq/stroom" aria-label="GitHub">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-12 col-sm-4 text-center py-2 order-sm-2">
        <small class="text-white">&copy; 2021 Crown Copyright 2021 All Rights Reserved</small>
        
	
      </div>
    </div>
  </div>
</footer>


    </div>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js" integrity="sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF" crossorigin="anonymous"></script>






 













<script src="/stroom-docs/hugo-docsy/js/main.min.3b172c13b62c2bea8b1c9d2599cddc8cf89718a92d792c680871c81ba43d8c85.js" integrity="sha256-OxcsE7YsK&#43;qLHJ0lmc3cjPiXGKkteSxoCHHIG6Q9jIU=" crossorigin="anonymous"></script>




  </body>
</html>
